---
title             : "Paradoxical evidence weighting in confidence judgments for detection and discrimination"
shorttitle        : "Paradoxical evidence weighting in confidence judgments for detection and discrimination"

author: 
  - name          : "Matan Mazor"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "12 Queen Square, London WC1N 3BG"
    email         : "mtnmzor@gmail.com"
  - name          : "Lucie Charles"
    affiliation   : "4"
  - name          : "Roni Maimon-Mor"
    affiliation   : "4" 
  - name          : "Stephen M. Fleming"
    affiliation   : "1,2,3"

affiliation:
  - id            : "1"
    institution   : "Wellcome Centre for Human Neuroimaging, UCL"
  - id            : "2"
    institution   : "Max Planck UCL Centre for Computational Psychiatry and Ageing Research"
  - id            : "3"
    institution   : "Department of Experimental Psychology, UCL"
  - id            : "4"
    institution   : "Institute of Cognitive Neuroscience, UCL"

authornote: |
  The authors have no conflicting interests to declare.

abstract: | 
  When making discrimination decisions between two stimulus categories, subjective confidecne judgments are more positively affected by evidence in support of a decision than negatively affected by evidence against it. Recent theoretical proposals suggest that this “positive evidence bias” may be due to observers adopting a detection-like strategy when rating their confidence, one that has functional benefits for metacognition in real-world settings where detectability and discriminability often go hand in hand. However, it is unknown whether, or how, this evidence weighting asymmetry is also in play for detection decisions about the presence or absence of a stimulus. In three experiments (one lab-based and two online) we first successfully replicate a positive evidence bias in discrimination confidence. We then show that detection decisions and confidence ratings paradoxically suffer from an opposite “negative evidence bias” to negatively weigh evidence even when it is optimal to assign it a positive weight. We show that the two effects are uncorrelated, and discuss our findings in relation to models that account for a positive evidence bias as emerging from a confidence-specific heuristic, and alternative models where decision and confidence are generated by the same, Bayes-rational process.

  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "confidence, detection, metacognition"
wordcount         : "X"

bibliography      : ["RC.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_word


---

```{r RC_load_pkgs, echo=FALSE, message=FALSE, include=FALSE}
# List of packages required for this analysis
pkg <- c("dplyr", "ggplot2", "knitr", "bookdown")
# Check if packages are not installed and assign the
# names of the packages not installed to the variable new.pkg
new.pkg <- pkg[!(pkg %in% installed.packages())]
# If there are any packages in the list that aren't installed,
# install them
if (length(new.pkg)) {
  install.packages(new.pkg, repos = "https://cran.rstudio.com")
}
# Load packages

library("papaja")
r_refs("r-references.bib")
library('tidyverse')
library('broom')
library('cowplot')
library('MESS') # for AUCs
library('lsr') # for effect sizes
library('pwr') # for power calculations
library('brms') # for mixed effects modeling
library('BayesFactor') # for Bayesian t test
library('jsonlite') #parsing data from sort_trial
library('knitr')
library('egg')
library('zoo') # for rollapply
library('RColorBrewer')
library('reticulate') # for python

source("trialLevelAnalysisFunctions.R", local = knitr::knit_global())
source("visualizationFunctions.R", local = knitr::knit_global())
source("reverseCorrelationFunctions.R", local = knitr::knit_global())

```

# Introduction

When considering two alternative hypotheses, the probability of the chosen hypothesis to be correct is a function of the availability of evidence supporting not only the chosen hypothesis, but also the unchosen one. For example, when deciding that there are more ants in the kitchen than in the living room, confidence should not only positively weigh the number of ants found in the kitchen (*positive evidence*), but also negatively weigh the number of ants found in the living room (*negative evidence*). Specifically, a decision should be based on the difference in the number of ants between the kitchen and the living room, but not on the total number of ants found in both rooms together (we refer to these quantities as *relative evidence* and *sum evidence*, respectively).

While sum evidence is irrelevant to discrimination decisions between two symmetrical hypotheses (e.g., kitchen or living room), it is highly informative with respect to detection decisions about the presence or absence of a signal. For example, when deciding that an ant colony is nesting in the house, the total number of ants found in both rooms is highly relevant, even more so than the difference between the number of ants found in the kitchen or living room (see Fig. \@ref(fig:RC-2d-models) for a signal detection formulation).

(ref:RC-2dmodels) Discrimination and detection in a two-dimensional Signal Detection Theory model. Left: in a two-dimensional SDT model, evidence $e$ is sampled from one of two Gaussian distributions (here centered at (0,1) and (1,0)). We define relative evidence as $e_{S1}-e_{S2}$ and sum evidence as $e_{S1}+e_{S2}$. Circles represent contours of two-dimensional distributions. Center and Left: decision and confidence accuracy are maximized when based on a log-likelihood ratio for the two stimulus categories. Center: in discrimination, this yields optimal decision and confidence criteria that are based on relative evidence (distance from the main diagonal), irrespective of sum evidence. Right: in detection, this yields optimal decision and confidence that are based on a non-linear interaction between relative and sum evidence. The third circle centred at (0,0) represents the two-dimensional distribution of percepts in the absence of stimuli.

```{r RC-2d-models, fig.cap="(ref:RC-2dmodels)"}

knitr::include_graphics('figures/2dmodel_enhanced.png')

```



A surprising finding is that despite the irrelevance of sum evidence to the accuracy of discrimination decisions, people are systematically more confident in perceptual decisions when sum evidence is high. For example, @zylberberg2012construction had subjects judge which of two flickering stimuli was brighter on average. Subjects were more confident in their decisions when both stimuli were bright, indicating an effect of sum evidence (here, overall luminance) on decision confidence. A positive effect of sum evidence on decision confidence is mathematically equivalent to a disproportional weighting of positive evidence over negative evidence, also known as a positive evidence bias [@koizumi2015does; @peters2017perceptual; @rollwage2020confidence; @samaha2020positive; @sepulveda2020visual; @zylberberg2012construction]. The two are equivalent because positively weighing the sum of positive and negative evidence effectively weakens the negative contribution of negative evidence to decision confidence, while strengthening the contribution of positive evidence. Notably, an effect of sum evidence on discrimination confidence may indicate a profound link between discrimination confidence and detection decisions [@rausch2018confidence].

Different models identify the origin of this evidence weighting asymmetry at different levels of the cognitive hierarchy, going from a metacognitive bias to ignore conflicting information [metacognitive level; @peters2017perceptual; @maniscalco2016heuristic], through asymmetries in the active sampling of evidence [attention allocation level; @sepulveda2020visual], down to perceptual asymmetries between the representations of signal and noise [perception level; @miyoshi2020decision; @webb2021task]. These models vary in whether they postulate separate evidence accumulation processes for decision and confidence judgments, and in whether they model confidence formation as following a suboptimal heuristic, or alternatively as being optimal with respect to available information (information which may be limited or corrupted by noise).

Here we focus on a subset of models which assume that subjects are rational decision makers equipped with veridical beliefs about the world, but that they only have limited access to noisy evidence. Our models further assume that subjects’ confidence ratings are Bayesian estimates of the probability of being correct, given the exact same evidence that was used to make the decision. The models do not postulate any metacognitive biases, heuristics, or suboptimalities. We show that two of these models reproduce a positive evidence bias (that is, a positive effect of sum evidence) in discrimination confidence. The same models also make predictions for evidence weighting in detection judgments and confidence ratings. In four experiments, reverse correlation reveals evidence weighting patterns that only partly agree with the predictions of our models. Most notably, our four models fail to account for a negative evidence bias in detection decisions and confidence. In what follows we first describe the four models and the predictions they make, before turning to empirical findings from our four experiments.

# Computational models

We model a setting in which agents are presented with a sequence of samples from two sensory channels: $E_1$ and $E_2$. The agents’ task is to decide which of the two channels was the signal channel (discrimination), or whether any of the channels had signal in it at all (detection). When a signal is present in a channel, evidence E is sampled from a normal distribution $\mathcal{N}(0.5,1)$, and when a signal is absent evidence is sampled from $\mathcal{N}(0,1)$ (see Fig. \@ref(fig:RC-models), upper panel). In all four models agents only have access to a noisy version of these samples $E'$, corrupted by sensory noise. After each time step, they update their belief about the relative likelihood of the observed samples under the two possible world states (signal in channel 1 versus 2, or signal presence versus absence), and given full knowledge of the true sample-generating process, including the properties of sensory noise. Each trial comprises 12 time steps. At the end of a trial, agents report the world state that maximizes the likelihood of the observed evidence, and rate their confidence as the objective probability that their decision was correct given likelihood estimates. The four models vary in the properties of sensory noise, and in the selection of some channels for inspection by selection mechanisms.

(ref:RC-models) Computational models. Upper panel: True world model. Stimuli span 12 timepoints, each comprising values from two sensory channels (here presented as luminance values). In discrimination blocks, values in one channel are sampled from the noise distribution (red), and values in the other channel are sampled from the signal distribution (blue). In detection blocks, on half of the trials all values are sampled from the noise distribution (red). Vanilla model: on each timepoint, participants perceive both channels, corrupted by sensory noise that is sampled from a normal distribution. They then update their beliefs accordingly. Stimulus-dependent noise model: the standard deviation of the sensory noise distribution is exponential with respect to signal intensity. Random attention model: agents only attend one channel at a time. The attended channel is chosen at random per timepoint, with a strong bias to be consistent within a trial. Goal-directed attention model: channels that are likely to include signal based on previous samples are more likely to be attended.

```{r RC-models, fig.cap="(ref:RC-models)"}

knitr::include_graphics('figures/models.png')

```

## Vanilla

In the basic, vanilla model, sensory noise is sampled from a normal distribution $\mathcal{N}(0,2)$. This model corresponds to a standard equal-variance signal detection setting, as illustrated in Fig. \@ref(fig:RC-2d-models).

## Stimulus-dependent noise

The stimulus-dependent noise model is similar to the vanilla model, with the exception that perceptual noise increases with signal intensity (formally, perceptual noise is sampled from a normal distribution $\mathcal{N}(0,2^{E})$). This assumption is biologically plausible: the representation of signal is expected to be inherently more variable due to the Weber-Fechner law [@fechner1860elements] and the coupling between firing rate mean and variability implied by a Poisson form for neuronal firing rates. Identifying the origin of the positive evidence bias at the perceptual level, this model shares family resemblance with the perceptual model of @miyoshi2020decision. However, two important differences are worth pointing out. First, here perceptual noise is conditioned not on stimulus class, but on the perceptual sample. This seems more plausible, as the perceptual system has no access to stimulus class beyond the information that is available in perceptual samples. And second, here we assume that confidence ratings are made based on all available evidence in a Bayes-rational way, rather than following a heuristic.

## Random attention

In this model, sensory noise is again sampled from $\mathcal{N}(0,2)$, irrespective of signal intensity. Unlike the vanilla model, however, here agents have access to one channel per timepoint only (they “attend” to one channel at a time). On each trial, agents are biased to attend to one preferred channel, chosen at random. Then, on each timepoint, they attend to one channel (the preferred channel with probability 0.95), and update their beliefs accordingly. We include this model because it is inherently asymmetrical: on each trial, evidence from the preferred channel contributes more to decision and confidence.

## Goal-directed attention

This model is similar to the sensory noise model, except that here attention is biased to channels that are more likely to include signal. Specifically, agents track the log likelihood ratio $LLR_r$ between signal in the left or in the right channels, and the probability of attending the right channel is set to $S(LLR_r$ where $S$ is a sigmoid function with a steep slope of 5. A highly similar drift diffusion model was shown to produce a positive evidence bias in confidence ratings [@sepulveda2020visual].

```{r RC-analyze-simulations, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE,fig.show='hide'}

sim = list()

sim$df <- read_csv('../simulations/equal_variance/discrimination.csv') %>%
  mutate(detection=0, eccentricity='ev', signal=1, subj_id=floor(trial_id/100)) %>%
  dplyr::select(detection,subj_id,trial_id,bright_side,signal,timepoint,side,
                eccentricity,evidence,decision,confidence, correct) %>%
  rbind(read_csv('../simulations/equal_variance/detection.csv') %>%
  mutate(detection=1, eccentricity='ev',subj_id=floor(trial_id/100))%>%
    dplyr::select(detection,subj_id,trial_id,bright_side,signal,timepoint,side,
                  eccentricity,evidence,decision,confidence, correct)) %>%
  rbind(read_csv('../simulations/unequal_variance/discrimination.csv') %>%
  mutate(detection=0, eccentricity='uv',subj_id=floor(trial_id/100),signal=1)%>%
    dplyr::select(detection,subj_id,trial_id,bright_side,signal,timepoint,side,
                  eccentricity,evidence,decision,confidence, correct))%>%
  rbind(read_csv('../simulations/unequal_variance/detection.csv') %>%
  mutate(detection=1, eccentricity='uv',subj_id=floor(trial_id/100))%>%
    dplyr::select(detection,subj_id,trial_id,bright_side,signal,timepoint,side,
                  eccentricity,evidence,decision,confidence, correct)) %>%
  rbind(read_csv('../simulations/random_attention/discrimination.csv') %>%
  mutate(detection=0, eccentricity='ra',subj_id=floor(trial_id/100),signal=1)%>%
    dplyr::select(detection,subj_id,trial_id,bright_side,signal,timepoint,side,
                  eccentricity,evidence,decision,confidence, correct))%>%
  rbind(read_csv('../simulations/random_attention/detection.csv') %>%
  mutate(detection=1, eccentricity='ra',subj_id=floor(trial_id/100))%>%
    dplyr::select(detection,subj_id,trial_id,bright_side,signal,timepoint,side,
                  eccentricity,evidence,decision,confidence, correct)) %>%
  rbind(read_csv('../simulations/goal_directed_attention/discrimination.csv') %>%
  mutate(detection=0, eccentricity='gda',subj_id=floor(trial_id/100),signal=1)%>%
    dplyr::select(detection,subj_id,trial_id,bright_side,signal,timepoint,side,
                  eccentricity,evidence,decision,confidence, correct))%>%
  rbind(read_csv('../simulations/goal_directed_attention/detection.csv') %>%
  mutate(detection=1, eccentricity='gda',subj_id=floor(trial_id/100))%>%
    dplyr::select(detection,subj_id,trial_id,bright_side,signal,timepoint,side,
                  eccentricity,evidence,decision,confidence, correct)) %>%
  mutate(eccentricity=factor(eccentricity, levels=c('ev','uv','ra','gda')))

sim$demeaned_df <- sim$df %>%
  mutate(evidence=ifelse(signal==1 & side==bright_side,
                evidence-0.5,
                evidence),
         time=(timepoint-1));

sim$discRCdf <- sim$demeaned_df %>%
  filter(detection==0) %>%
  mutate(obj_side=factor(ifelse(side==bright_side,
                         'true',
                         'opposite'),levels=c('true','opposite')),
         side = factor(ifelse(decision==side,
                       'chosen',
                       'unchosen'),
                       levels=c('chosen','unchosen'))) %>%
  dplyr::select(subj_id,timepoint,obj_side,side,eccentricity,confidence, trial_id,evidence, time, correct) %>%
  group_by(subj_id) %>%
  mutate(median_confidence=median(confidence)) %>%
  ungroup() %>%
  mutate(
    binaryconf = ifelse(confidence>=median_confidence, 1, 0),
  );

sim$signalRCdf <- sim$demeaned_df %>%
  filter(detection==1 & signal==1) %>%
  mutate(side=factor(ifelse(side==bright_side,
                         'true',
                         'opposite'),levels=c('true','opposite')),
         response=decision) %>%
  dplyr::select(subj_id,timepoint,side,eccentricity,confidence, trial_id,evidence, time, correct,response) %>%
  group_by(subj_id,response) %>%
  mutate(median_confidence=median(confidence)) %>%
  ungroup() %>%
  mutate(
    binaryconf = ifelse(confidence>=median_confidence, 1, 0)
  );

sim <- sim %>% 
  getDiscriminationKernels() %>%
  contrastDiscriminationKernels()

sim$discrimination_accuracy_kernel %>%
  group_by(eccentricity,subj_id,contrast) %>%
  summarise(evidence=mean(evidence)) %>%
  group_by(eccentricity,contrast) %>%
  summarise(mean_evidence=mean(evidence),
            se_evidence=se(evidence)) %>%
  ggplot(aes(x=eccentricity,y=mean_evidence,fill=contrast, 
             shape=eccentricity)) +
  geom_abline(intercept=0, slope=0,size=1) +
  geom_errorbar(aes(ymin=mean_evidence-se_evidence,
                    ymax=mean_evidence+se_evidence), 
                color='black')+
  geom_point(size=6) +
  scale_shape_manual(values=c(21,22,23,24))+
  scale_color_manual(values=evidence_colors)+
  scale_fill_manual(values=evidence_colors) +
  scale_y_continuous(limits=c(-0.2,0.5)) +
  theme_minimal()+theme(
    axis.text.y=element_blank(),
    axis.ticks.y=element_blank()) +
  labs(y='contrast',
       x='')+
  theme(legend.position = 'none');
  
  ggsave(paste('./figures/RC/sim/discrimination_accuracy.png',sep='/'),
         width=3.5,height=3)

sim$discrimination_confidence_kernel%>%
  group_by(side,eccentricity, subj_id) %>%
  summarise(evidence=mean(diff)) %>%
  group_by(side,eccentricity)%>%
  summarise(se=se(evidence),
            evidence=mean(evidence)) %>%
  ggplot(aes(x=eccentricity,y=evidence,fill=side,shape=eccentricity)) +
    geom_hline(yintercept=0)  +
  geom_abline(intercept=0, slope=0,size=1) +
  geom_errorbar(aes(ymin=evidence-se,
                    ymax=evidence+se), 
                color='black')+
  geom_point(size=6) +
  scale_shape_manual(values=c(21,22,23,24))+
  scale_color_manual(values=discrimination_colors)+
  scale_fill_manual(values=discrimination_colors) +
  scale_y_continuous(limits=c(-0.2,0.5)) +
  theme_minimal()+theme(
    axis.text.y=element_blank(),
    axis.ticks.y=element_blank()) +
  labs(y='evidence',
       x='')+
  theme(legend.position = 'none');

  ggsave(paste('./figures/RC/sim/discrimination_confidence.png',sep='/'),
         width=3.5,height=3)

  sim$discrimination_confidence_kernel %>% 
    group_by(eccentricity, subj_id) %>%
    summarise(relative_evidence=mean(diff[side=='chosen'])-mean(diff[side=='unchosen']),
              sum_evidence = mean(diff[side=='chosen'])+mean(diff[side=='unchosen'])) %>%
    pivot_longer(cols=ends_with('evidence'), names_to='contrast', values_to='evidence') %>%
    group_by(contrast,eccentricity) %>%
    summarise(se=se(evidence),
              evidence=mean(evidence)) %>%
    ggplot(aes(x=eccentricity,y=evidence,fill=contrast, shape=eccentricity)) +
    geom_abline(intercept=0, slope=0,size=1) +
    geom_errorbar(aes(ymin=evidence-se,
                      ymax=evidence+se), 
                  color='black')+
    geom_point(size=6) +
    scale_shape_manual(values=c(21,22,23,24))+
    scale_color_manual(values=evidence_colors)+
    scale_fill_manual(values=evidence_colors) +
    scale_y_continuous(limits=c(-0.2,0.5)) +
    theme_minimal()+theme(
      axis.text.y=element_blank(),
      axis.ticks.y=element_blank()) +
    labs(y='contrast',
         x='')+
    theme(legend.position = 'none');

  ggsave(paste('./figures/RC/sim/discrimination_confidence_sum_rel.png',sep='/'),
         width=3.5,height=3)
  
  sim <- sim %>% 
  getDetectionSignalKernels() %>%
  contrastDetectionSignalKernels()
  
  sim$signal_decision_kernel %>%
    group_by(side,eccentricity, subj_id) %>%
    summarise(evidence = mean(evidence)) %>%
    group_by(side,eccentricity) %>%
    summarise(se=se(evidence),
              evidence=mean(evidence)) %>%
  ggplot(aes(x=eccentricity,y=evidence,fill=side,shape=eccentricity))+
  geom_abline(intercept=0, slope=0,size=1) +
  geom_errorbar(aes(ymin=evidence-se,
                    ymax=evidence+se), 
                color='black')+
  geom_point(size=6) +
  scale_shape_manual(values=c(21,22,23,24))+
  scale_color_manual(values=detection_colors)+
  scale_fill_manual(values=detection_colors) +
  scale_y_continuous(limits=c(-0.2,0.5)) +
  theme_minimal()+theme(
    axis.text.y=element_blank(),
    axis.ticks.y=element_blank()) +
  labs(y='evidence',
       x='')+
  theme(legend.position = 'none');
  
  ggsave(paste('./figures/RC/sim/detection_decision.png',sep='/'),
         width=3.5,height=3)
  
  sim$signal_decision_kernel %>%
    group_by(subj_id,side,eccentricity) %>%
    summarise(evidence=mean(evidence)) %>%
    group_by(subj_id,eccentricity)%>%
    summarise(rel_evidence = evidence[side=='true']-evidence[side=='opposite'],
              sum_evidence = evidence[side=='true']+evidence[side=='opposite']) %>%
    pivot_longer(cols = ends_with('evidence'),names_to='contrast',values_to='evidence')%>%
    group_by(contrast,eccentricity) %>%
    summarise(se=se(evidence),
              evidence=mean(evidence)) %>%
    ggplot(aes(x=eccentricity,y=evidence,fill=contrast, shape=eccentricity)) +
    geom_abline(intercept=0, slope=0,size=1) +
    geom_errorbar(aes(ymin=evidence-se,
                      ymax=evidence+se), 
                  color='black')+
    geom_point(size=6) +
    scale_shape_manual(values=c(21,22,23,24))+
    scale_color_manual(values=detection_colors)+
    scale_fill_manual(values=detection_colors) +
    scale_y_continuous(limits=c(-0.2,0.5)) +
    theme_minimal()+theme(
      axis.text.y=element_blank(),
      axis.ticks.y=element_blank()) +
    labs(y='evidence',
         x='')+
    theme(legend.position = 'none');
  


  ggsave(paste('./figures/RC/sim/detection_decision_sum_rel.png',sep='/'),
         width=3.5,height=3);
  
  sim$signal_confidence_kernel %>%
    filter(response==1)%>%
    group_by(subj_id,side,eccentricity) %>%
    summarise(evidence=mean(diff)) %>%
    group_by(side,eccentricity) %>%
    summarise(se=se(evidence),
              evidence=mean(evidence))%>%
  ggplot(aes(x=eccentricity,y=evidence,fill=side,shape=eccentricity))+
  geom_abline(intercept=0, slope=0,size=1) +
  geom_errorbar(aes(ymin=evidence-se,
                    ymax=evidence+se), 
                color='black')+
  geom_point(size=6) +
  scale_shape_manual(values=c(21,22,23,24))+
  scale_color_manual(values=detection_colors)+
  scale_fill_manual(values=detection_colors) +
  scale_y_continuous(limits=c(-0.2,0.5)) +
  theme_minimal()+theme(
    axis.text.y=element_blank(),
    axis.ticks.y=element_blank()) +
  labs(y='evidence',
       x='')+
  theme(legend.position = 'none');
  

  ggsave(paste('./figures/RC/sim/detection_conf_yes.png',sep='/'),
         width=3.5,height=3)
  
  sim$signal_confidence_kernel%>%
    filter(response==1)%>%
    group_by(subj_id,eccentricity) %>%
    summarise(rel_evidence=mean(diff[side=='true'])-mean(diff[side=='opposite']),
              sum_evidence = mean(diff[side=='true'])+mean(diff[side=='opposite'])) %>%
      pivot_longer(cols = ends_with('evidence'),names_to='contrast',values_to='evidence')%>%
      group_by(contrast,eccentricity) %>%
      summarise(se=se(evidence),
                evidence=mean(evidence)) %>%
    ggplot(aes(x=eccentricity,y=evidence,fill=contrast, shape=eccentricity)) +
    geom_abline(intercept=0, slope=0,size=1) +
    geom_errorbar(aes(ymin=evidence-se,
                      ymax=evidence+se), 
                  color='black')+
    geom_point(size=6) +
    scale_shape_manual(values=c(21,22,23,24))+
    scale_color_manual(values=evidence_colors)+
    scale_fill_manual(values=evidence_colors) +
    scale_y_continuous(limits=c(-0.2,0.5)) +
    theme_minimal()+theme(
      axis.text.y=element_blank(),
      axis.ticks.y=element_blank()) +
    labs(y='evidence',
         x='')+
    theme(legend.position = 'none');
  

  ggsave(paste('./figures/RC/sim/detection_conf_yes_sum_rel.png',sep='/'),
         width=3.5,height=3)
  
    sim$signal_confidence_kernel %>%
    filter(response==0)%>%
    group_by(subj_id,side,eccentricity) %>%
    summarise(evidence=mean(diff)) %>%
    group_by(side,eccentricity) %>%
    summarise(se=se(evidence),
              evidence=mean(evidence))%>%
  ggplot(aes(x=eccentricity,y=evidence,fill=side,shape=eccentricity))+
  geom_abline(intercept=0, slope=0,size=1) +
  geom_errorbar(aes(ymin=evidence-se,
                    ymax=evidence+se), 
                color='black')+
  geom_point(size=6) +
  scale_shape_manual(values=c(21,22,23,24))+
  scale_color_manual(values=detection_colors)+
  scale_fill_manual(values=detection_colors) +
  scale_y_continuous(limits=c(-0.2,0.5)) +
  theme_minimal()+theme(
    axis.text.y=element_blank(),
    axis.ticks.y=element_blank()) +
  labs(y='evidence',
       x='')+
  theme(legend.position = 'none');
  

  ggsave(paste('./figures/RC/sim/detection_conf_no.png',sep='/'),
         width=3.5,height=3)
  
  sim$signal_confidence_kernel%>%
    filter(response==0)%>%
    group_by(subj_id,eccentricity) %>%
    summarise(rel_evidence=mean(diff[side=='true'])-mean(diff[side=='opposite']),
              sum_evidence = mean(diff[side=='true'])+mean(diff[side=='opposite'])) %>%
      pivot_longer(cols = ends_with('evidence'),names_to='contrast',values_to='evidence')%>%
      group_by(contrast,eccentricity) %>%
      summarise(se=se(evidence),
                evidence=mean(evidence)) %>%
    ggplot(aes(x=eccentricity,y=evidence,fill=contrast, shape=eccentricity)) +
    geom_abline(intercept=0, slope=0,size=1) +
    geom_errorbar(aes(ymin=evidence-se,
                      ymax=evidence+se), 
                  color='black')+
    geom_point(size=6) +
    scale_shape_manual(values=c(21,22,23,24))+
    scale_color_manual(values=evidence_colors)+
    scale_fill_manual(values=evidence_colors) +
    scale_y_continuous(limits=c(-0.2,0.5)) +
    theme_minimal()+theme(
      axis.text.y=element_blank(),
      axis.ticks.y=element_blank()) +
    labs(y='evidence',
         x='')+
    theme(legend.position = 'none');
  

  ggsave(paste('./figures/RC/sim/detection_conf_no_sum_rel.png',sep='/'),
         width=3.5,height=3)
  
```

We simulated 10,000 discrimination and 10,000 detection trials per model (100 trials x 100 simulated agents per model). On each discrimination trial, the signal channel could be right or left with equal probability. On half of the detection trials both channels were noise channels. We then sampled, for each trial, 12 values from each channel. These 24 values were then passed on to the simulated agent, who returned a decision and a confidence rating. We then subjected the agents’ decisions and confidence ratings to a reverse correlation analysis. We now turn to describe this analysis, which will also be used to analyze the behaviour of (actual!) participants in Exp. 1-4.

## Reverse correlation analysis

Following @zylberberg2012construction, we took a reverse correlation approach and asked which sources of evidence (positive, negative, relative, and sum evidence) contribute to agents’ decisions and confidence ratings. This analysis focuses on random fluctuations in signal intensity, and asks how they affect behaviour (here, decisions and confidence in these decisions). For simplicity, here we collapse across timepoints instead of correlating noise with decision or confidence per timepoint, as we do for human data.

## Methodological note: positive evidence bias in perceptual decisions

The positive evidence bias in decision confidence is often seen as particularly striking, given that positive and negative evidence are equally weighted in forming a decision [@zylberberg2012construction; @peters2017perceptual]. For example, using reverse correlation, @zylberberg2012construction showed that momentary fluctuations in the availability of perceptual evidence for and against a decision were equally predictive of the decision itself. Similarly, @peters2017perceptual showed that in classifying rapidly presented images as ‘face’ or ‘house’, decisions are not solely guided by positive evidence (e.g., face-related brain activity when deciding ‘face’), but also by negative evidence (e.g., house-related brain activity when deciding ‘face’).

In both cases, it is useful to ask what it would look like for an agent to only consider positive evidence in making a decision. This soon becomes circular, because positive and negative evidence are defined with respect to the decision itself. For example, when analyzing the decisions of an agent that consistently ignores evidence for one alternative (similar to the random attention model above), both positive and negative evidence should still be predictive of decisions. The effect of positive evidence is then driven by those trials in which the agent selected the attended alternative, and the effect of negative evidence by those trials in which the agent selected the ignored alternative (because the evidence for the attended alternative was insufficient). Put differently, asymmetries of positive and negative evidence cannot affect the decision itself, because at the time of making the decision there is no positive and negative evidence, but two sources of evidence that may become positive or negative, depending on the decision. For this reason, in measuring evidence weighting in decision formation, we defined positive and negative evidence relative to the ground truth rather than the agents’ decision.


## Discrimination decisions

First, to make sure we are measuring true random fluctuations and not systematic differences between noise and signal channel, we mean centered all signal channels to 0. ‘Sum evidence’ was defined as the total sum of noise terms across both channels $E_r+E_l$. ‘Relative evidence’ was defined as the difference in noise terms between the signal and non-signal channels ($E_r-E_l$ when $E_r$ was the signal channel and $E_l-E_r$ when $E_l$ was the signal channel). All four models predicted that the probability of correctly identifying the signal channel in the discrimination task should increase with relative evidence (Fig. \@ref(fig:RC-simulations)A, orange markers). The models predicted no effect of sum evidence on discrimination decisions.


(ref:RC-simulations) Predictions for the reverse correlation analysis, derived from the four models. A: the effect of relative (orange markers) and sum (black markers) evidence on discrimination decision. B: the effect of evidence for the chosen (green markers) and unchosen (purple markers) alternatives on discrimination confidence. C: the effect of sum and relative evidence (defined with respect to participants’ decisions) on discrimination confidence. Panels D, F and H: The effect of evidence in the signal channel (blue markers) and in the non-signal channel (red markers) on detection decisions, confidence in yes responses, and confidence in no responses, respectively. Panels E, G, and I: The effect of relative evidence (orange markers) and sum evidence (black markers) on detection decisions, confidence in yes responses, and confidence in no responses, respectively. Stars represent significance in a two-sided t-test: \*: p<0.05, \*\*: p<0.01, \*\*\*: p<0.001.

```{r RC-simulations, fig.cap="(ref:RC-simulations)"}

knitr::include_graphics('figures/RC/sim/summary.png')

```

## Discrimination confidence

The median confidence rating was used to split evidence channels into four sets, according to decision (chosen or unchosen, depending on the agent’s decision) and confidence level (high or low). Confidence kernels for the chosen and unchosen channels were then extracted by subtracting the mean low-confidence from the mean high-confidence vectors for each channel. In all four models, agents were more confident in their discrimination decisions when confidence strengthened evidence in the chosen direction (Fig. \@ref(fig:RC-simulations)B, green markers) and weakened evidence in the unchosen direction (Fig. \@ref(fig:RC-simulations)B, purple markers). As expected, this translated to an effect of relative evidence on decision confidence: agents were more confident when the evidence difference between the chosen and unchosen channels was high (Fig. \@ref(fig:RC-simulations)C, orange markers).

Critically, only the stimulus-dependent noise and goal-directed attention models produced an effect of sum evidence on decision confidence, such that agents were more confident when overall evidence was high (Fig. \@ref(fig:RC-simulations)C, black markers). As reviewed above, this is a positive evidence bias in discrimination confidence.

## Detection decisions

For the reverse correlation analysis of detection decisions, we focused on trials in which a signal was present. This allowed us to disentangle the effects of evidence in the signal and non-signal channels on detection decisions and confidence. We subtracted evidence in trials that resulted in a ‘no’ (target absent) decision from evidence in trials that resulted in a ‘yes’ (target present) decision, separately for the signal and non-signal channels. All four models predicted that agents should be more likely to respond ‘yes’ when evidence is stronger in the signal channel (Fig. \@ref(fig:RC-simulations)D, blue markers). Importantly, the same was true for evidence in the non-signal channel: agents were more likely to respond ‘yes’ when evidence was stronger in this channel too (Fig. \@ref(fig:RC-simulations)D, red markers). Together, these two positive effects translated to a strong effect of sum evidence on detection decisions: agents were more likely to respond ‘yes’ when the total sum of evidence was high (Fig. \@ref(fig:RC-simulations)E, black markers). A weaker effect of relative evidence on detection decisions was observed in all models except for the random attention model (Fig. \@ref(fig:RC-simulations)E, orange markers).

## Detection confidence

Similar to the discrimination task, the median confidence rating was used to split evidence channels into four sets, according to signal (signal channel or non-signal channel) and confidence level (high or low). This was done separately for ‘yes’ and ‘no’ responses. Confidence kernels for the signal and non-signal channels were then extracted by subtracting the mean low-confidence from the mean high-confidence evidence values for each channel and decision.

In all four models, agents were more confident in their decisions about signal presence when evidence in the signal channel was stronger (Fig. \@ref(fig:RC-simulations)F, blue markers). Mirroring the detection decision kernels, confidence in signal presence was also positively affected by evidence for signal in the non-signal channel (Fig. \@ref(fig:RC-simulations)F, red markers). Together, these two positive effects produced an overall positive effect of sum evidence on confidence in presence (Fig. \@ref(fig:RC-simulations)G, black markers). All four models predicted a weaker effect of relative evidence (Fig. \@ref(fig:RC-simulations)G, orange markers).

Finally, in all four models, agents were more confident in decisions about signal absence when evidence in both signal and non-signal channels was weaker (Fig. \@ref(fig:RC-simulations)H, blue and red markers, respectively). Together, these negative effects translated to a total negative effect of sum evidence on confidence in absence (Fig. \@ref(fig:RC-simulations)I, black markers). None of the four models predicted a negative effect of relative evidence on confidence in absence, but the random attention model predicted a subtle positive effect (Fig. \@ref(fig:RC-simulations)I, orange markers).

# Experiment 1

## Methods

### Participants

The research complied with all relevant ethical regulations, and was approved by the Research Ethics Committee of University College London (study ID number 1260/003). 10 participants were recruited via the UCL’s psychology subject pool, and gave their informed consent prior to their participation. Each participant performed four sessions of 600 trials each, in blocks of 100 trials. Sessions took place on different days and consisted of 3 discrimination blocks interleaved with 3 detection blocks.

### Experimental procedure

The experimental procedure for Exp. 1 largely followed the procedure described in @zylberberg2012construction, Exp. 1. Participants observed a random-dot kinematogram for a fixed duration of 700 ms. In discrimination trials, the direction of motion was one of two opposite directions with equal probability, and participants reported the observed direction by pressing one of two arrow keys on a standard keyboard. In detection blocks participants reported whether there was any coherent motion by pressing one of two arrow keys on a standard keyboard. In half of the detection trials dots moved coherently to one of two opposite directions, and in the other half all dots moved randomly.

In both detection and discrimination blocks, participants indicated their confidence following each decision. Confidence was reported on a continuous scale ranging from chance to complete certainty. To avoid systematic response biases affecting confidence reports, the orientation (vertical or horizontal) and polarity (e.g., right or left) of the scale was set to agree with the type 1 response. For example, following an up arrow press, a vertical confidence bar was presented where ‘guess’ is at the center of the screen and ‘certain’ appeared at the upper end of the scale (see Fig. \@ref(fig:RC-design1)).

(ref:RC-design1) Task design for Experiment 1. In both discrimination and detection blocks, participants viewed 700 milliseconds of a random dot motion array, after which they made a keyboard response to indicate their decision (motion direction in discrimination, signal absence or presence in detection), followed by a continuous confidence report using the mouse. 5 participants viewed vertically moving dots and indicated their detection responses on a horizontal scale, and 5 participants viewed horizontally moving dots and indicated their detection responses on a vertical scale.

```{r RC-design1, fig.cap="(ref:RC-design1)"}

knitr::include_graphics('figures/design1.png')

```

To control for response requirements, for five subjects the dots moved to the right or to the left, and for the other five subjects they moved upward or downward. The first group made discrimination judgments with the right and left keys and detection judgments with the up and down keys, and this mapping was reversed for the second group. The number of coherently moving dots (‘motion coherence’) was adjusted to maintain performance at around 70% accuracy for detection and discrimination tasks independently. This was achieved by measuring mean accuracy after every 20 trials, and adjusting coherence by a step of 3% if accuracy fell below 60% or went above 80%.

Stimuli for discrimination blocks were generated using the exact same procedure reported in @zylberberg2012construction^[We reused the original Matlab code that was used for Exp. 1 in Zylberberg et. al. (2012), kindly shared by Ariel Zylberberg. ]. Trials started with a presentation of a fixation cross for one second, immediately followed by stimulus presentation. The stimulus consisted of 152 white dots (diameter = $0.14^\circ$), presented within a $6.5^\circ$ circular aperture centered on the fixation point for 700 milliseconds (42 frames, frame rate = 60 Hz). Dots were grouped in two sets of 76 dots each. Every other frame, the dots of one set were replaced with a new set of randomly positioned dots. For each coherence value of $c'$, a proportion of $c'$ of the dots from the second set moved coherently in one direction by a fixed distance of $0.33^\circ$, while the remaining dots in the set moved in random directions by a fixed distance of $0.33^\circ$. On the next update, the sets were switched, to prevent participants from tracing the position of specific dots. Frame-specific coherence values were sampled for each screen update from a normal distribution centred around the coherence value $c$ with a standard deviation of 0.07, with the constraint that $c'$ must be a number between 0 and 1.

Stimuli for detection blocks were generated using a similar procedure, where on a random half of the trials coherence was set to 0%, without random sampling of coherence values for different frames.

To probe global metacognitive estimates of task performance, at the end of each experimental block (100 trials) participants estimated the number of correct responses they have made. Analysis of these global metacognitive estimates is provided in Appendix \@ref(global).

## Analysis

Experiment 1 was pre-registered (pre-registration document is available here: [https://osf.io/z2s93/](https://osf.io/z2s93/)). Our full pre-registered analysis is available in the Appendix.

## Reverse correlation analysis

For the reverse correlation analysis, we followed a procedure similar to the one described in @zylberberg2012construction. For each of the four directions (right, left, up and down), we applied two spatiotemporal filters to the frames of the dot motion stimuli as described in previous studies (Adelson & Bergen, 1985; Zylberberg et al., 2012). The outputs of the two filters were squared and summed, resulting in a three-dimensional matrix with motion energy in a specific direction as a function of x, y, and time. We then took the mean of this matrix across the x and y dimensions to obtain an estimate of the overall temporal fluctuations in motion energy in the selected direction. Using this filter, we obtained estimates of temporal fluctuations in the mean and variance of motion energy for upward, downward, leftward and rightward motion within each trial. Additionally, for every time point we extracted the variance along the x and y dimensions, but given a high correlation between our mean and variance estimates, we focused our analysis on the mean motion energy.

In order to distill random fluctuations in motion energy from mean differences between stimulus categories, we subtracted the mean motion energy from trial-specific motion energy vectors. The mean motion energy vectors were extracted at the group level, separately for each motion coherence level and as a function of motion direction. We chose this approach instead of the linear regression approach used by @zylberberg2012construction in order to be sensitive to the possibility of nonlinear effects of coherence on motion energy.

# Results

```{r RC-exp1-load-and-format-data, echo=FALSE, cache=TRUE, message=FALSE}

e1 = list()


e1$df <- read_csv('../experiments/Experiment1/data/RC.csv', lazy=FALSE) %>%
  group_by(subj_id, detection) %>%
  mutate(confidence=confidence/1000,
         # in the original coding, 3 is right and 1 is left. 
         # changed to be 0 for right/up and 1 for left/down, to align 
         # with the coding of responses.
         direction = ifelse(direction==3,1,0)); 
 
e1$trial_df_unfiltered <- e1$df %>%
  group_by(subj_id, trial_id) %>%
  summarise(
    detection = detection[timepoint==1],
    direction = direction[timepoint==1],
    signal = signal[timepoint==1],
    response = response[timepoint==1],
    RT = RT[timepoint==1]-700, # stimulus duration
    confidence = confidence[timepoint==1],
    correct = correct[timepoint==1],
    trial_number = trial_number[timepoint==1],
    logRT = log(RT[timepoint==1]),
    conf_bi = ifelse(
        response==1, 
        as.numeric(confidence),
        -1*as.numeric(confidence)))%>%
  group_by(subj_id) %>%
  mutate(
    conf_discrete = ntile(confidence,20) %>%
      factor(levels=1:21))

e1$task_stats_unfiltered <- e1$trial_df_unfiltered %>%
  group_by(subj_id,detection) %>%
  summarise(acc=mean(correct),
            RT = median(RT),
            confidence=mean(confidence));

e1$trial_df <- e1$trial_df_unfiltered %>%
  filter(trial_number>300);

e1$detection_df <- e1$trial_df %>%
  filter(detection==1) %>%
  mutate(stimulus=signal);

e1$discrimination_df <- e1$trial_df %>%
  filter(detection==0) %>%
  mutate(stimulus = direction);

```


```{r RC-exp1-general-stats, echo=FALSE, cache=TRUE, message=FALSE}
e1 <- e1 %>% 
  generalStats2Tasks() %>%
  testAUC() %>%
  testzROC2tasks();
```

### Decision accuracy

Overall proportion correct was `r e1$task_stats_unfiltered%>%filter(detection==0)%>%pull(acc)%>%mean()%>%printnum()` in the discrimination and `r e1$task_stats_unfiltered%>%filter(detection==1)%>%pull(acc)%>%mean()%>%printnum()` in the detection task. Performance for discrimination was significantly higher than for detection (`r t.test(e1$task_stats_unfiltered%>%filter(detection==0)%>%pull(acc), e1$task_stats_unfiltered%>%filter(detection==1)%>%pull(acc), paired=TRUE)%>%apa_print()%>%'$'(full_result)`). This difference in task performance reflected a slower convergence of the staircasing procedure for the discrimination task during the first session. When discarding all data from the first session and analyzing only data from the last three sessions (1800 trials per participant), task performance was equated between the two tasks at the group level (`r t.test(e1$task_stats%>%filter(detection==0)%>%pull(acc), e1$task_stats%>%filter(detection==1)%>%pull(acc), paired=TRUE)%>%apa_print()%>%'$'(full_result)`; `r ttestBF(e1$task_stats%>%filter(detection==0)%>%pull(acc), e1$task_stats%>%filter(detection==1)%>%pull(acc), paired=TRUE)%>%apa_print()%>%'$'(statistic)`).  In order to avoid confounding differences between discrimination and detection decision and confidence profiles with more general task performance effects, the first session was excluded from all subsequent analyses.

### Overall properties of response time and confidence distributions

In detection, participants were more likely to respond 'yes' than 'no' (mean proportion of 'yes' responses: `r t.test(e1$detection_stats$general$bias,mu=0.5)%>%apa_print()%>%'$'(full_result)`). We did not observe a consistent response bias for the discrimination data (mean proportion of 'rightward' or 'upward' responses: `r t.test(e1$discrimination_stats$general$bias,mu=0.5)%>%apa_print()%>%'$'(full_result)`). 

Replicating previous studies [@meuwese2014subjective; @mazor2020distinct; @kellij2021investigation; @mazor2021stage], we find the typical asymmetries between detection 'yes' and 'no' responses in response time, overall confidence, and the alignment between subjective confidence and objective accuracy (also termed metacognitive sensitivity, here measured as the area under the response-conditional type 2 ROC curve; see Fig. \@ref(fig:RC-exp1-asymmetries)). 'No' responses were slower compared to 'yes' responses (median difference: `r e1$detection_stats$contrast_responses%>%pull(RT)%>%median()%>%abs()%>%printnum()` ms), and accompanied by lower levels of subjective confidence (mean difference of `r e1$detection_stats$contrast_responses$confidence%>%mean()%>%printnum()` on a 0-1 scale). Metacognitive sensitivity was higher for detection 'yes' compared with detection 'no' responses (mean difference in area under the curve units: `r e1$AUC%>%filter(detection==1)%>%pull(metacognitive_asymmetry)%>%mean()%>%printnum()`). No difference in response time, confidence, or metacognitive sensitivity was found between the two discrimination responses. For a detailed statistical analysis of these behavioural asymmetries see Appendix \@ref(appRC:asymmetries1).

(ref:exp1-asymmetries) Behavioural asymmetries in metacognitive sensitivity, response time, and overall confidence in detection (upper panel) and discrimination (lower panel), in Exp. 1. Left: Response conditional type 2 ROC curves for the two tasks and four responses in Exp. 1. The area under the type 2 ROC curve is a measure of metacognitive sensitivity, and the difference in areas between the two responses a measure of metacognitive asymmetry. Single-subject curves are presented in low opacity. Right: distributions of the area under the type 2 ROC curve, median response time, and mean confidence for the four responses, across participants. Box edges and central lines represent the 25, 50 and 75 quantiles. Whiskers cover data points within four inter-quartile ranges around the median. Stars represent significance in a two-sided t-test: \*\*: p<0.01, \*\*\*: p<0.001


```{r RC-exp1-asymmetries, echo=FALSE, message=FALSE, fig.cap="(ref:exp1-asymmetries)", fig.scap="Behavioural asymmetries in metacognitive sensitivity, response time, and overall confidence, in Exp. 1"}

# plotAllAsymmetries(e1,'figures/RC-exp1-asymmetries.pdf');
knitr::include_graphics("figures/RC-exp1-asymmetries-enhanced.png")
```

### Reverse correlation


```{r RC-exp1-discrimination-RC, echo=FALSE, message=FALSE, results='hide', warning=FALSE, fig.cap="(ref:exp1-discrimination)", fig.scap="Reverse correlation of discrimination trials, Exp. 1", fig.show='hide'}

e1$discRCdf <- e1$df %>%
  filter(detection==0 & 
           trial_number>300) %>%
  dplyr::select(-c('energyDown','energyUp'))%>%
  pivot_longer(cols=starts_with('energy'),values_to='energy',names_to='measured_direction')%>%
  mutate(measured_direction=ifelse(measured_direction=='energyRight',0,1),
         obj_side=factor(ifelse(measured_direction==direction, 'true','opposite'),
                         levels=c('true','opposite')),
         side=ifelse(response==measured_direction,'chosen','unchosen'),
         session = round(trial_number/300)) %>%
  group_by(subj_id, session) %>%
  mutate(median_confidence=median(confidence)) %>%
  ungroup() %>%
  mutate(
    binaryconf = ifelse(confidence>=median_confidence, 1, 0),
    eccentricity=1,
    time=(timepoint-4)/60*1000)%>%
  group_by(obj_side)%>%
  mutate(evidence=energy/sd(energy))

e1 <- e1 %>% 
  getDiscriminationKernels() %>%
  contrastDiscriminationKernels()

e1$discrimination_accuracy_kernel <- e1$discrimination_accuracy_kernel %>%
  group_by(subj_id, contrast)%>%
  arrange(time) %>%
  mutate(evidence=rollapply(evidence,5,mean,align='right',fill=NA))

e1$discrimination_confidence_kernel <- e1$discrimination_confidence_kernel %>%
  group_by(subj_id, side)%>%
  arrange(time) %>%
  mutate(diff=rollapply(diff,5,mean,align='right',fill=NA));

e1 %>% plotDiscriminationKernels('exp1',c(0,750),c(-0.3,0.4))
```

#### Discrimination

Using reverse correlation we quantified the effect of random fluctuations in motion energy on the probability of correctly identifying the true direction of motion, and on the temporal dynamics of decision formation. Following @zylberberg2012construction, we focused our analysis on the first 300 ms of the trial. Participants’ discrimination responses were significantly affected by the relative evidence for the true direction of motion compared to the opposite direction (`r apa_print(e1$RC$accuracy_rel300$diff%>%t.test())$statistic`), whereas sum evidence (the total amount of energy in both directions) had no effect on discrimination accuracy (`r apa_print(e1$RC$accuracy_sum300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp1-RC)A). This is consistent with a symmetric weighting of positive and negative evidence in decision formation, and with the predictions of all four models.

We then turned to the contribution of motion energy to subjective confidence ratings. The median confidence rating in each experimental session was used to split all motion energy vectors into four groups, according to decision (chosen or unchosen directions) and confidence level (high or low). Confidence kernels for the chosen and unchosen directions were then extracted by subtracting the mean low-confidence from the mean high-confidence vectors for both the chosen and unchosen directions. Motion energy in the chosen direction (positive evidence) significantly increased confidence (`r apa_print(e1$RC$confidence_pos300$diff%>%t.test())$statistic`), but we found no significant decrease in confidence with stronger motion energy in the opposite direction (negative evidence; `r apa_print(e1$RC$confidence_neg300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp1-RC)B). Equivalently, both relative and sum evidence positively contributed to decision confidence (relative evidence: `r apa_print(e1$RC$confidence_rel300$diff%>%t.test())$statistic`; sum evidence: `r apa_print(e1$RC$confidence_sum300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp1-RC)C). This is a replication of the Positive Evidence Bias observed in @zylberberg2012construction, and consistent with the predictions of the stimulus-dependent noise and goal-directed attention models.

```{r RC-exp1-signal-RC, echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.cap="(ref:exp1-discrimination)", fig.scap="Reverse correlation of discrimination trials, Exp. 1", fig.show='hide'}

e1$signalRCdf <- e1$df %>%
  filter(detection==1 & 
           signal==1 &
           trial_number>300) %>%
  dplyr::select(-c('energyDown','energyUp'))%>%
  pivot_longer(cols=starts_with('energy'),values_to='energy',names_to='measured_direction')%>%
  mutate(measured_direction=ifelse(measured_direction=='energyRight',0,1),
         side=factor(ifelse(measured_direction==direction, 'true','opposite'),
                     levels=c('true','opposite')),
         session = round(trial_number/300)) %>%
  group_by(subj_id, session,response) %>%
  mutate(median_confidence=median(confidence)) %>%
  ungroup() %>%
  mutate(
    binaryconf = ifelse(confidence>=median_confidence, 1, 0),
    eccentricity=1,
    time=(timepoint-4)/60*1000)%>%
  group_by(side)%>%
  mutate(evidence=energy/sd(energy))

e1 <- e1 %>% 
  getDetectionSignalKernels() %>%
  contrastDetectionSignalKernels()

e1$signal_decision_kernel <- e1$signal_decision_kernel %>%
  group_by(subj_id,side)%>%
  arrange(time) %>%
  mutate(evidence=rollapply(evidence,5,mean,align='right',fill=NA))

e1$signal_confidence_kernel <- e1$signal_confidence_kernel %>%
  group_by(subj_id, side,response)%>%
  arrange(time) %>%
  mutate(diff=rollapply(diff,5,mean,align='right',fill=NA));

e1 %>% plotDetectionSignalKernels('exp1',c(0,750),c(-0.3,0.4))
```

#### Detection

Carrying out an analogous reverse correlation analysis for detection introduces a challenge: while ‘no’ responses reflect a belief in the absence of any coherent motion, ‘yes’ responses can result from detection of any type of coherent motion going in either direction (or both). We chose to have two possible motion directions in the detection task in order to prevent participants from making ‘no’ responses based on significant motion in an unexpected direction. While this choice ensured that participants cannot accumulate evidence for absence, it also made the reverse correlation analysis more difficult, as we did not have full access to participants’ beliefs about the stimulus when they responded ‘yes’.

In order to approximate participants’ belief states during ‘yes’ responses, we focused our analysis on trials in which coherent motion was presented in one of the two directions (signal trials). We then asked whether fluctuations in the true and opposite directions of motion contributed to detection decision and confidence. This was done by subtracting the motion energy vectors for ‘yes’ and ‘no’ responses in the true and opposite motion directions.

(ref:RC-exp1-RC) Reverse correlation, Exp. 1. A: the effect of relative (black curve) and sum (orange curve) evidence on discrimination decision. Note that relative evidence here is defined with respect to the true direction of motion, not participants’ decisions. B: the effect of evidence for the chosen (green curve) and unchosen (purple curve) alternative on discrimination confidence. C: the effect of sum and relative evidence (defined with respect to participants’ decisions) on discrimination confidence. Panels D, F and H: The effect of evidence for the true direction of motion (blue curve) and for the opposite direction of motion (red curve) on detection decisions, confidence in yes responses, and confidence in no responses, respectively. Panels E, G, and I: The effect of relative evidence (black curve) and sum evidence (orange curve) on detection decisions, confidence in yes responses, and confidence in no responses, respectively. The first 300 milliseconds of the trial are marked in yellow. Stars represent significance in a two-sided t-test for the first 300 milliseconds of the trial: \*: p<0.05, \*\*: p<0.01, \*\*\*: p<0.001.

```{r RC-exp1-RC, echo=FALSE, message=FALSE, fig.cap="(ref:RC-exp1-RC)"}

knitr::include_graphics("figures/RC/exp1/summary.png")
```


Participants were significantly more likely to respond ‘yes’ when fluctuations in motion energy during the first 300 milliseconds of the trial strengthened motion energy in the true direction of motion (`r apa_print(e1$RC$signal_decision_pos300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp1-RC)D, blue curve). Critically, and in contrast to the predictions of all four models, motion energy in the opposite direction had a negative, rather than a positive effect on detection decision (`r apa_print(e1$RC$signal_decision_neg300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp1-RC)D, red curve).

Confidence ratings were higher in detection ‘yes’ responses when random noise strengthened the motion energy in the true direction of motion (`r apa_print(e1$RC$signal_confidenceYes_pos300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp1-RC)F, blue curve). Again, in contrast to our model predictions, motion energy in the opposite direction had a negative, rather than a positive effect on detection decisions (`r apa_print(e1$RC$signal_confidenceYes_neg300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp1-RC)F, red curve).

Furthermore, unlike in the discrimination task, here we found no effect of sum evidence on confidence ratings (`r apa_print(e1$RC$signal_confidenceYes_sum300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp1-RC)G, black curve). To reiterate, while detection decisions were mostly sensitive to fluctuations in motion energy toward the true direction of motion, confidence in detection ‘yes’ responses was equally sensitive to fluctuations in the true and opposite directions of motion. However, and to anticipate the results of Exp. 3 presented below, we note that this equal weighting of positive and negative evidence in detection confidence was not replicated in a subsequent experiment designed to directly test this surprising result.

Finally, confidence in ‘no’ responses was independent of relative, sum, positive, and negative evidence (all p's>0.1; see Fig. 6H). 

# Experiment 2

In Exp. 1, we replicated previous observations of a positive evidence bias in discrimination confidence, such that confidence scaled with the total sum of evidence for both hypotheses. In contrast, in detection an effect of sum evidence was apparent for the decision, but not for the confidence kernels. Furthermore, confidence in detection ‘no’ responses was not at all affected by fluctuations in motion energy.

In Exp. 2 we tested the generalizability of these findings to a different type of stimuli (flickering patches) and mode of data collection (a ~10 minute online experiment). Our pre-registered objectives (documented here: [https://osf.io/d3vkm/](https://osf.io/d3vkm/)) were 1) to replicate a positive evidence bias in discrimination confidence, 2) to replicate the absence of a positive evidence bias in detection confidence, 3) to replicate the absence of an effect of either positive or negative evidence on confidence in ‘no’ judgments.

## Methods

### Participants

The research complied with all relevant ethical regulations, and was approved by the Research Ethics Committee of University College London (study ID number 1260/003). 147 participants were recruited via Prolific (prolific.co) and gave their informed consent prior to their participation. They were selected based on their acceptance rate (>95%) and for being native English speakers. Following our pre-registration, we aimed to collect data until we had reached 100 included participants based on our pre-specified inclusion criteria (see [https://osf.io/d3vkm/](https://osf.io/d3vkm/)). Our final data set includes observations from 102 included participants. The entire experiment took around 10 minutes to complete. Participants were paid £1.25 for their participation, equivalent to an hourly wage of £7.5.


### Experimental paradigm

The experiment was programmed using the jsPsych and P5 JavaScript packages [@de2015jspsych; @mccarthy2015p5], and was hosted on a JATOS server [@lange2015jatos]. It consisted of two tasks (Detection and Discrimination) presented in separate blocks. A total of 56 trials of each task was delivered in 2 blocks of 28 trials each. The order of experimental blocks was interleaved, starting with discrimination.

The first discrimination block started after an instruction section, which included instructions about the stimuli and confidence scale, four practice trials and four confidence practice trials. Further instructions were presented before the second block. Instruction sections were followed by multiple-choice comprehension questions, to monitor participants’ understanding of the main task and confidence reporting interface. To encourage concentration, feedback was delivered at the end of the second and fourth blocks about overall performance and mean confidence in the task.

Importantly, unlike the lab-based experiment, there was no calibration of difficulty for the two tasks. The rationale for this is that in Exp. 1 perceptual thresholds for motion discrimination were highly consistent across participants, and staircasing took a long time to converge. Furthermore, in Exp. 1 we aimed to control for task difficulty, but this introduced differences between the stimulus intensity in detection and discrimination. To complement our findings, here we aimed to match stimulus intensity between the two tasks, and accept that task performance might vary.

### Trial structure

In discrimination blocks, trial structure closely followed Exp. 2 from @zylberberg2012construction, with a few adaptations. Following a fixation cross (500 ms), two sets of four adjacent vertical gray bars were presented as a rapid serial visual presentation (RSVP; 12 frames, presented at 25Hz), displayed to the left and right of the fixation cross (see Fig. 7). On each frame, the luminance of each bar was randomly sampled from a Gaussian distribution with a standard deviation of 10/255 units in the standard RGB 0-255 coordinate system. For one set of bars, this Gaussian distribution was centered at the same luminance value as the background (128/255). For the other set, it was centered at 133/255, making it brighter on average. Participants then reported which of the two sets was brighter on average using the ‘D’ and ‘F’ keys on the keyboard. After their response, they rated their confidence on a continuous scale, by controlling the size of a colored circle with their mouse. High confidence was mapped to a big, blue circle, and low confidence to a small, red circle. To discourage hasty confidence ratings, the confidence rating scale stayed on the screen for at least 2000 milliseconds. Feedback about decision accuracy was delivered after the confidence rating phase.

(ref:RC-design2) Task design for Experiment 2. In both tasks, participants viewed 480 milliseconds of two flickering patches, after which they made a keyboard response to indicate which of the patches was brighter (discrimination) or whether any of the patches was brighter than the background (detection).

```{r RC-design2, fig.cap="(ref:RC-design2)"}

knitr::include_graphics('figures/design2.png')

```

Detection blocks were similar to discrimination blocks, with the exception that decisions were made about whether the average luminance of either of the two sets was brighter than the gray background, or not. In ‘different’ trials, the luminance of the four bars in one of the sets was sampled from a Gaussian distribution with mean 133/255, and the luminance of the other set from a Gaussian distribution with mean 128/255. In ‘same’ trials, the luminance of both sets was sampled from a distribution centered at 128/255. Decisions in Detection trials were reported using the ‘Y’ and ‘N’ keys. Confidence ratings and feedback were as in the discrimination task.

### Randomization

The order and timing of experimental events was determined pseudo-randomly by the Mersenne Twister pseudorandom number generator, initialized in a way that ensures registration time-locking [@mazor2019novel]. 


## Results

```{r RC-exp2-load-and-format-data, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE}

e2=list()

e2$df <- read_csv('../experiments/Experiment2/data/Flicker.csv', lazy=FALSE) %>%
  group_by(s,task,trial_index) %>%
  mutate(side=c(rep(0,48),rep(1,48)),
         timepoint=rep(1:12,8), 
         eccentricity = rep(c(rep(1,12),rep(2,12),rep(3,12),rep(4,12)),2)) %>%
  rename(subj_id = s,
         trial_id = trial_index) %>%
  mutate(detection = ifelse(task=='detection',1,0),
         bright_side=ifelse(bright_side=='right',1,0),
         signal=signal_presence,
         detection=as.factor(detection),
         response=as.factor(response),
         correct=as.factor(correct),
         subj_id=as.factor(subj_id)) %>%
  ungroup() %>%
  dplyr::select(subj_id,detection,trial_id,
                RT,signal,correct,bright_side,
                response,conf_RT,confidence,
                luminance,side,timepoint,
                eccentricity,trial)


e2$trial_df <- e2$df %>%
  group_by(subj_id, trial_id) %>%
  summarise(
    detection = detection[side==1 & timepoint==1 & eccentricity == 1],
    bright_side = bright_side[side==1 & timepoint==1 & eccentricity == 1],
    signal = signal[side==1 & timepoint==1 & eccentricity == 1],
    response = response[side==1 & timepoint==1 & eccentricity == 1],
    RT = RT[side==1 & timepoint==1 & eccentricity == 1]-480, # stimulus duration
    confidence = confidence[side==1 & timepoint==1 & eccentricity == 1],
    correct = correct[side==1 & timepoint==1 & eccentricity == 1],
    trial_number = trial[side==1 & timepoint==1 & eccentricity == 1],
    conf_bi = ifelse(
      response==1, 
      as.numeric(confidence),
      -1*as.numeric(confidence)),
    luminance_0=mean(luminance[side==0 & timepoint<8]),
    luminance_1=mean(luminance[side==1 & timepoint<8]))%>%
  group_by(subj_id) %>%
  mutate(
    conf_discrete = ntile(confidence,20) %>%
      factor(levels=1:21),
    logRT=log(RT));

e2$detection_df <- e2$trial_df %>%
  filter(detection==1) %>%
  mutate(stimulus=signal);

e2$discrimination_df <- e2$trial_df %>%
  filter(detection==0) %>%
  mutate(stimulus = bright_side);
```

```{r RC-exp2-general-stats, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE}

e2 <- e2 %>% generalStats2Tasks() %>%
  testAUC() %>%
  testzROC2tasks();

e2$zROC <- rbind(e2$detection_zROC%>%mutate(detection=1),
                 e2$discrimination_zROC%>%mutate(detection=0));

e2$zROC_contast_rsquare <- e2$zROC%>%group_by(subj_id)%>%summarize(fit_diff=r.squared[detection==1]-r.squared[detection==0])

```

### Decision accuracy

Overall proportion correct was `r e2$task_stats%>%filter(detection==0)%>%pull(acc)%>%mean()%>%printnum()` in the discrimination and `r e2$task_stats%>%filter(detection==1)%>%pull(acc)%>%mean()%>%printnum()` in the detection task. Performance for discrimination was significantly higher than for detection (`r t.test(e2$task_stats%>%filter(detection==0)%>%pull(acc), e2$task_stats%>%filter(detection==1)%>%pull(acc), paired=TRUE)%>%apa_print()%>%'$'(full_result)`). Unlike in Exp. 1, where we aimed to control for task difficulty, here we decided to match stimulus intensity between the two tasks, so a difference between detection and discrimination performance was expected [@wickens2002elementary, 104]. 

### Overall properties of decision and confidence distributions

Similar to Exp. 1, participants were more likely to respond 'yes' than 'no' in the detection task (mean proportion of 'yes' responses: `r t.test(e2$detection_stats$general$bias,mu=0.5)%>%apa_print()%>%'$'(full_result)`). We did not observe a consistent response bias in discrimination (mean proportion of 'right' responses: `r t.test(e2$discrimination_stats$general$bias,mu=0.5)%>%apa_print()%>%'$'(full_result)`). 

As in Exp. 1, we also found behavioural asymmetries between the two detection responses (see Fig. \@ref(fig:RC-exp2-asymmetries)), with 'yes' responses being faster (median difference of `r e2$detection_stats$contrast_responses%>%pull(RT)%>%median()%>%abs()%>%printnum()` ms) and accompanied by higher levels of confidence (mean difference of `r e2$detection_stats$contrast_responses$confidence%>%mean()%>%printnum()` on a 0-1 scale). Unlike in Exp. 1, here we found no evidence for a difference in metacognitive sensitivity between 'yes' and 'no' responses (mean difference of `r e2$AUC%>%filter(detection==1)%>%pull(metacognitive_asymmetry)%>%mean()%>%printnum()` in AUC units). No asymmetries were observed between the two discrimination responses. For a detailed statistical analysis see Appendix \@ref(appRC:asymmetries2).

(ref:exp2-asymmetries) Behavioural asymmetries in metacognitive sensitivity, response time, and overall confidence, in Exp. 2. Same conventions as in Fig. \@ref(fig:RC-exp1-asymmetries).

```{r RC-exp2-asymmetries, echo=FALSE, message=FALSE, fig.scap="Behavioural asymmetries in metacognitive sensitivity, response time, and overall confidence, in Exp. 2",  fig.cap= "(ref:exp2-asymmetries)"}
# plotAllAsymmetries(e2,'figures/RC-exp2-asymmetries.pdf');
knitr::include_graphics("figures/RC-exp2-asymmetries-enhanced.png")
```

### Reverse correlation 

Stimuli in Exp. 2 consisted of two flickering patches, each comprising 4 gray bars presented for 12 frames. Together, this summed to 96 random luminance values per trial, which we subjected to reverse correlation analysis, following the analysis procedure of Exp 2. in @zylberberg2012construction.  


```{r RC-exp2-discrimination-RC, echo=FALSE, message=FALSE, results='hide', warning=FALSE, fig.show='hide'}

e2$demeaned_df <- e2$df %>%
  mutate(
    evidence = ifelse(side==bright_side & signal==1,
                      (luminance-133)/5,
                      (luminance-128)/5)
  )

e2$discRCdf <- e2$demeaned_df %>%
  filter(detection==0) %>%
  mutate(obj_side=factor(ifelse(side==bright_side, 'true','opposite'),
                         levels=c('true','opposite')),
         side=ifelse(response==side,'chosen','unchosen')) %>%
  group_by(subj_id) %>%
  mutate(median_confidence=median(confidence)) %>%
  ungroup() %>%
  mutate(
    binaryconf = ifelse(confidence>=median_confidence, 1, 0),
    time=(timepoint-1)*40) 

e2 <- e2 %>% 
  getDiscriminationKernels() %>%
  contrastDiscriminationKernels() %>%
  plotDiscriminationKernels('exp2',c(0,440),c(-0.4,0.7))
```

#### Discrimination decisions 

First, we asked whether random fluctuations in luminance had an effect on participants’ discrimination responses. Similar to the results obtained by Zylberberg et. al., discrimination decisions were sensitive to fluctuations in relative evidence (the difference in mean luminance between the left and right stimulus) during the first 300 milliseconds of the trial (`r apa_print(e2$RC$accuracy_rel300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp2-RC)A, orange curve). Furthermore, participants’ decisions were surprisingly more sensitive to negative compared to positive evidence within the same time window, resulting in a negative effect of sum evidence (`r apa_print(e2$RC$accuracy_sum300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp2-RC)A, black curve). Importantly, this negative effect of sum evidence on decision accuracy was not replicated in Exp. 3 and 4.

(ref:RC-exp2-RC) Reverse correlation, Exp. 2. Same conventions as in Fig. \@ref(fig:RC-exp1-RC).

```{r RC-exp2-RC, echo=FALSE, message=FALSE, fig.cap="(ref:RC-exp2-RC)"}

knitr::include_graphics("figures/RC/exp2/summary.png")
```

#### Discrimination confidence

Similar to Exp. 1, here too we observed a significant effect of positive (`r apa_print(e2$RC$confidence_pos300$diff%>%t.test())$statistic`) and negative (`r apa_print(e2$RC$confidence_neg300$diff%>%t.test())$statistic`) evidence on decision confidence within the first 300 milliseconds of the stimulus (see Fig. \@ref(fig:RC-exp2-RC)B). Replicating @zylberberg2012construction, this effect was significantly stronger for the chosen stimulus, producing an effect of sum evidence on decision confidence that is consistent with a positive evidence bias(`r apa_print(e2$RC$confidence_sum300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp2-RC)C, black curve).

```{r RC-exp2-signal-RC, echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.show='hide'}

e2$signalRCdf <- e2$demeaned_df %>%
  filter(detection==1 & signal==1) %>%
  mutate(side=factor(ifelse(side==bright_side, 'true','opposite'),
                         levels=c('true','opposite'))) %>%
  group_by(subj_id,response) %>%
  mutate(median_confidence=median(confidence)) %>%
  ungroup() %>%
  mutate(
    binaryconf = ifelse(confidence>=median_confidence, 1, 0),
    time=(timepoint-1)*40) 

e2 <- e2 %>% 
  getDetectionSignalKernels() %>%
  contrastDetectionSignalKernels() %>%
  plotDetectionSignalKernels('exp2',c(0,440),c(-0.4,0.7))
```

#### Detection

Participants’ detection decisions were sensitive to fluctuations in the luminance of the target stimulus, such that ‘yes’ responses were associated with a brighter target stimulus (`r apa_print(e2$RC$signal_decision_pos300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp2-RC)D, blue curve). Similar to Exp. 1, and in contrast to the behaviour of Bayes-rational simulated agents, the luminance of the non-target stimulus had a negative effect on the probability of responding ‘yes’ (`r apa_print(e2$RC$signal_decision_neg300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp2-RC)D, red curve).

Confidence in detection ‘yes’ responses was similarly sensitive to fluctuations in the luminance of the target stimulus (`r apa_print(e2$RC$signal_confidenceYes_pos300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp2-RC)F, blue curve). Again, brighter non-target stimuli made participants less, rather than more, confident in the presence of a signal (`r apa_print(e2$RC$signal_confidenceYes_neg300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp2-RC)F, red curve). As in Exp. 1, here too sum evidence (overall luminance) had no significant effect on confidence in detection ‘yes’ responses (`r apa_print(e2$RC$signal_confidenceYes_sum300$diff%>%t.test())$statistic`; see Fig. \@ref(fig:RC-exp2-RC)G, black curve). This surprising result was not replicated in Experiments 3 and 4.

Finally, confidence in detection ‘no’ responses was sensitive to random fluctuations in the luminance of the target, such that participants were more confident in the absence of a signal when the target stimulus was darker (t(96)=-2.28, p=.025; see Fig. @ref(fig:RC_exp2-RC)G). The overall luminance of the display also had a negative effect on confidence in detection ‘no’ responses (`r apa_print(e2$RC$signal_confidenceNo_sum300$diff%>%t.test())$statistic`; see Fig. @ref(fig:RC-exp2-RC)I). The luminance of the non-target stimulus (`r apa_print(e2$RC$signal_confidenceNo_neg300$diff%>%t.test())$statistic`) and the difference in luminance between the two stimuli (`r apa_print(e2$RC$signal_confidenceNo_rel300$diff%>%t.test())$statistic`) had no significant effects on confidence in detection ‘no’ responses.


# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup

# Open Practices Statement

The data and materials for all experiments are available at github.com/matanmazor/reverseCorrelation. All three experiments were pre-registered (Exp. 1: https://osf.io/z2s93/ ; Exp. 2: https://osf.io/d3vkm/; Exp. 3: https://osf.io/hm3fn/)
